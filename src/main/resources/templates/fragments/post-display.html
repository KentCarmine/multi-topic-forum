<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
    <head>
        <meta charset="UTF-8">
        <title>Post</title>
    </head>
    <body>
        <div th:fragment="post-fragment (post)"> <!--TODO: Add upvote/downvote display and arg-->
            <div th:id="'post_id_' + ${post.getId()}">
                <div>
                    <span>
                        <a href="#" th:href="@{'/users/' + ${post.getUser().getUsername()}}" th:text="${post.getUser().getUsername()}">Poster</a>
                    </span>
                    <span> @ </span>
                    <span th:text="${post.getPostedAt().toString()}">Timestamp</span>

                    <span th:if="${loggedInUser == null || post.isDeleted()}">
                        <span> | </span>
                        <span th:text="${post.getVoteCount()}"></span>
                    </span>

                    <span th:if="${!post.isDeleted() && loggedInUser != null}">
                        <span>
                            <input type="image" alt="Upvote" width="32" height="32" th:class="upvote-button"
                                   th:attr="data-post-id=${post.getId()}" th:disabled="${voteMap.get(post.getId()) != 0}"
                                   th:src="${voteMap.get(post.getId()) == 1} ? '/images/black-arrow-green-filled.png' : '/images/green-arrow-hollow.png'"
                                   th:name="${'upvote-button-post-id-' + post.getId()}">
                        </span>

                        <span th:class="vote-counter" th:attr="data-post-id=${post.getId()}"
                              th:text="${post.getVoteCount()}" th:name="${'vote-counter-post-id-' + post.getId()}">
                            ###
                        </span>

                        <span>
                            <input type="image" alt="Downvote" width="32" height="32" th:class="downvote-button"
                                   th:attr="data-post-id=${post.getId()}" th:disabled="${voteMap.get(post.getId()) != 0}"
                                   th:src="${voteMap.get(post.getId()) == -1} ? '/images/black-arrow-red-filled.png' : '/images/red-arrow-hollow.png'"
                                   th:name="${'downvote-button-post-id-' + post.getId()}">
                        </span>
                    </span>

                    <span sec:authorize="hasAnyAuthority('MODERATOR', 'ADMINISTRATOR', 'SUPER_ADMINISTRATOR')">
                        <span th:if="${!post.isDeleted()}">
                            <input type="button" th:attr="data-post-id=${post.getId()}"
                                   th:name="${'delete-button-post-id-' + post.getId()}"
                                   th:disabled="${!post.isDeletableBy(loggedInUser)}"
                                   class="delete-post-button"
                                   th:value="#{Label.post.delete}">
                        </span>
                        <span th:if="${post.isDeleted()}">
                            <input type="button" th:attr="data-post-id=${post.getId()}"
                                   th:name="${'restore-button-post-id-' + post.getId()}"
                                   th:disabled="${!post.isRestorableBy(loggedInUser)}"
                                   class="restore-post-button"
                                   th:value="#{Label.post.restore}">
                        </span>
                    </span>
                </div>

                <div th:if="${!post.isDeleted()}" th:text="${post.getContent()}">
                    Content
                </div>
                <div th:if="${post.isDeleted()}">
                    <div th:text="#{Post.deleted.success.notification}">Post has been deleted.</div>

                    <div sec:authorize="hasAnyAuthority('MODERATOR', 'ADMINISTRATOR', 'SUPER_ADMINISTRATOR')" th:text="#{Label.post.originalContent} + ${post.getContent()}" >
                    </div>
                </div>
                <hr>

            </div>
        </div>

        <div th:fragment="post-summary-fragment (post)">
            <div>
                <span>
                    <a href="#" th:href="@{'/forum/' + ${post.getThread().getForum().getName()} + '/show/' + ${post.getThread().getId()} + '#post_id_' + ${post.getId()}}" th:text="${post.getThread().getTitle()}">Thread Title</a>
                </span>
                <span> @ </span>
                <span th:text="${post.getPostedAt().toString()}">Timestamp</span>
            </div>
            <div th:text="${post.getAbbreviatedContent()}"> <!--TODO: Restrict content length-->
                Abbreviated Content
            </div>
            <hr>
        </div>
    </body>
</html>